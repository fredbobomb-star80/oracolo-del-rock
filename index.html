<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chiedilo allâ€™oracolo del Rock â€” risposta casuale</title>
  <style>
    body{margin:0;background:#0b0b0f;color:#eee;font-family:system-ui,Arial,sans-serif}
    .wrap{max-width:920px;margin:32px auto;padding:0 16px;text-align:center}
    h1{font-size:28px;margin:8px 0 6px}
    p{opacity:.85}
    iframe{width:100%;aspect-ratio:16/9;border:0;border-radius:12px;background:#111}
    .btns{display:flex;gap:10px;justify-content:center;margin:16px 0;flex-wrap:wrap}
    button,a.btn{padding:10px 14px;border-radius:10px;border:1px solid #333;background:#1b1b22;color:#eee;cursor:pointer}
    button:hover,a.btn:hover{background:#262632}
    .note{font-size:13px;opacity:.7;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
   <h1>Chiedilo allâ€™Oracolo del Rock</h1>
    <p>Pesca una tra le <strong>666 risposte</strong> che gli Dei del Rock hanno in serbo per te.</p>

   <div id="yt"></div>

    <div class="btns">
      <button id="new">ðŸŽ² Nuova risposta</button>
      <a class="btn" id="open" target="_blank" rel="noopener">â†— Apri su YouTube</a>
    </div>

    <p class="note">Da una idea originale di FredBee tutti i diritti riservati Â©2025</p>
  </div>

  <!-- Qui ci sono TUTTI gli ID (lo generi al passo 3) -->


<script>
// === CONFIG ===
const API_KEY     = "AIzaSyDNsQKEwHOyZCJOmojJS325Sbw6wX9as"; // <-- metti la tua
const PLAYLIST_ID = "PL5l5Dspe3Obumt-dqGDVzM4bHp5Qc_vVx"; // tua playlist
const PAGE_SIZE   = 50; // massimo consentito dall'API

// Carico la YouTube IFrame API
(function(){
  const s=document.createElement('script');
  s.src="https://www.youtube.com/iframe_api";
  document.head.appendChild(s);
})();

let player = null;
let allIds = [];

window.onYouTubeIframeAPIReady = () => {
  player = new YT.Player('yt', {
    height: '390',
    width: '640',
    playerVars: { modestbranding:1, rel:0 },
    events: { onReady: onReady }
  });
};

function onReady(){
  document.getElementById("new").addEventListener("click", playRandom);
  boot();
}

async function boot(){
  try{
    allIds = await fetchAllPlaylistIds(PLAYLIST_ID);
    if(!allIds.length) throw new Error("Playlist vuota o non accessibile");
    playRandom(); // parte subito
  }catch(err){
    console.error(err);
    alert("Errore nel caricare la playlist. Controlla API key e visibilitÃ  playlist.");
  }
}

// Scarica TUTTE le pagine della playlist
async function fetchAllPlaylistIds(playlistId){
  let ids = [];
  let pageToken = "";
  do{
    const url = new URL("https://www.googleapis.com/youtube/v3/playlistItems");
    url.searchParams.set("key", API_KEY);
    url.searchParams.set("part", "snippet");
    url.searchParams.set("playlistId", playlistId);
    url.searchParams.set("maxResults", PAGE_SIZE);
    if(pageToken) url.searchParams.set("pageToken", pageToken);

    const res = await fetch(url.toString());
    if(!res.ok) throw new Error("HTTP "+res.status);
    const data = await res.json();

    const batch = (data.items||[])
      .map(i => i?.snippet?.resourceId?.videoId)
      .filter(Boolean);

    ids.push(...batch);
    pageToken = data.nextPageToken || "";
  } while(pageToken);

  // Filtra eventuali duplicati
  return [...new Set(ids)];
}

function playRandom(){
  if(!player || !allIds.length) return;
  const idx = Math.floor(Math.random() * allIds.length);
  const id  = allIds[idx];

  player.loadVideoById(id);
  // aggiorna il link "Apri su YouTube"
  const open = document.getElementById("open");
  if(open) open.href = `https://www.youtube.com/watch?v=${id}&list=${PLAYLIST_ID}`;
}
</script>




  
</body>
</html>










