<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chiedilo all‚ÄôOracolo del Rock</title>

  <!-- Font calligrafico per il testo carta -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap">

  <style>
    body{
      margin:0;
      background:#0b0b0f;
      color:#eee;
      font-family:system-ui,Arial,sans-serif;
      text-align:center;
    }

    /* CABINA */
    .hero{
      width:100%;
      max-width:980px;
      margin:0 auto;
      position:relative;
      display:flex;
      justify-content:center;
      padding-top:10px;
    }
    .hero-img{
      width:100%;
      height:auto;
      display:block;
    }

    /* ANIMAZIONE CABINA */
    .hero-img.activating{
      animation:
        heroShake 0.16s infinite alternate,
        powerOnFlash 1.7s ease-out forwards;
      transform-origin:center;
    }

    @keyframes heroShake{
      from{ transform: translate(0px, 0px); }
      to{   transform: translate(0.7px, -0.7px); }
    }

    @keyframes powerOnFlash{
      0%  { opacity:0; filter:brightness(0.3) contrast(0.8); }
      50% { opacity:1; filter:brightness(0.8) contrast(1.1); }
      70% { opacity:0; filter:brightness(0.4) contrast(1);   }
      85% { opacity:1; filter:brightness(1.4) saturate(1.6); }
      100%{ opacity:1; filter:brightness(1) contrast(1);      }
    }

    /* ============================
       AREA VIDEO ‚Äì PLAYER INVISIBILE 1x1
       ============================ */
    .yt-overlay{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%, -50%);
      width:1px;
      height:1px;
      opacity:0;
      pointer-events:none;
      overflow:hidden;
    }

    .yt-overlay iframe{
      width:1px;
      height:1px;
      border:0;
      box-shadow:none;
    }

    /* Qualunque stato: sempre invisibile */
    .yt-overlay.is-hidden,
    .yt-overlay.is-visible,
    .yt-overlay.is-visible.audio-first{
      opacity:0;
      transform:translate(-50%, -50%);
      pointer-events:none;
    }

    /* SEZIONE AZIONI SOTTO LA CABINA */
    .actions{
      margin-top:14px;
    }

    .share-row{
      text-align:center;
      margin-bottom:10px;
    }

    .share-btn{
      display:inline-block;
      padding:6px 14px;
      margin:0 4px;
      border-radius:999px;
      border:2px solid #ff00ff;
      background:#000;
      color:#fff;
      font-size:13px;
      font-weight:500;
      letter-spacing:0.03em;
      cursor:pointer;
      box-shadow:0 0 8px rgba(255,60,207,.2);
    }

    .share-btn-off{
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
      filter: grayscale(60%);
      pointer-events: none;
    }
    
    #new{
      background: linear-gradient(180deg, #0fe3ff 0%, #00a9d6 45%, #006b8a 100%);
      color:#001018;
      border: 2px solid rgba(0,200,255,0.9);
      padding:13px 26px;
      font-size:15px;
      border-radius:999px;
      font-weight:1000;
      cursor:pointer;
      letter-spacing:1px;
      box-shadow:
        0 6px 16px rgba(0,0,0,0.8),
        inset 0 2px 0 rgba(255,255,255,0.35),
        inset 0 -3px 8px rgba(0,0,0,0.6),
        0 0 14px rgba(0,200,255,0.65),
        0 0 30px rgba(0,200,255,0.35);
      transition: transform .12s ease, filter .12s.ease, box-shadow .12s ease;
      margin-top: 20px;
    }

    #new:hover{
      transform: translateY(-1px) scale(1.02);
      filter: brightness(1.12) saturate(1.1);
      box-shadow:
        0 8px 18px rgba(0,0,0,0.85),
        inset 0 2px 0 rgba(255,255,255,0.45),
        inset 0 -3px 10px rgba(0,0,0,0.7),
        0 0 18px rgba(0,200,255,0.9),
        0 0 42px rgba(0,200,255,0.55);
    }

    #new:active{
      transform: translateY(1px) scale(0.99);
      filter: brightness(0.98);
      box-shadow:
        0 3px 10px rgba(0,0,0,0.9),
        inset 0 3px 8px rgba(0,0,0,0.8),
        0 0 10px rgba(0,200,255,0.6);
    }

    #new.disabled{
      opacity:0.5;
      pointer-events:none;
      filter:grayscale(90%);
      animation: btnPulse 1s infinite alternate;
    }

    @keyframes btnPulse{
      from{
        box-shadow:
          0 4px 10px rgba(0,0,0,0.7),
          0 0 10px rgba(0,200,255,0.25);
      }
      to{
        box-shadow:
          0 6px 18px rgba(0,0,0,0.85),
          0 0 18px rgba(0,200,255,0.8);
      }
    }

    .wrap{
      max-width:920px;
      margin:0 auto;
      padding:18px 16px 40px;
      margin-top:2px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .social-buttons{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top:2px;
    }

    .social-btn{
      text-decoration:none;
      color:#ddd;
      background:#1a1a1a;
      border:2px solid #ff3ccf;
      padding:4px 10px;
      font-size:12px;
      border-radius:999px;
      font-weight:700;
      display:flex;
      align-items:center;
      gap:6px;
      transition:all .2s ease;
      box-shadow:0 0 8px rgba(255,60,207,.2);
    }

    .social-btn:hover{
      transform:scale(1.05);
      color:#fff;
    }

    .social-btn.youtube:hover{ background:#ff0000; border-color:#ff0000; }
    .social-btn.facebook:hover{ background:#1877f2; border-color:#1877f2; }
    .social-btn.instagram:hover{ background:#e4405f; border-color:#e4405f; }

    .note{ font-size:13px; opacity:.7; }

    /* TESTO NELLA CABINA */
    .oracle-text{
      position:absolute;
      top:72%; /* alzato rispetto alla versione base */
      left:50%;
      transform:translate(-50%, -50%);
      width:80%;
      color:#fffdf5;
      font-size:26px;
      line-height:1.25;
      text-align:center;
      font-family:"Great Vibes", cursive;
      font-weight:400;
      letter-spacing:0.03em;
      text-shadow:
        0 0 6px rgba(0,0,0,0.7),
        0 0 16px rgba(255,255,255,0.9),
        0 0 28px rgba(255,105,180,0.75);
      opacity:0;
      transition:opacity .6s ease;
    }

    .oracle-text.visible{
      opacity:1;
    }
  </style>
</head>

<body>

  <!-- CABINA ORACOLO -->
  <header class="hero">
    <img 
      src="https://raw.githubusercontent.com/fredbobomb-star80/oracolo-del-rock/main/214417.png"
      alt="Chiedilo all‚ÄôOracolo del Rock"
      class="hero-img"
    />

    <!-- TESTO ORACOLO -->
    <div id="oracle-text" class="oracle-text"></div>

    <!-- PLAYER YT INVISIBILE -->
    <div id="yt" class="yt-overlay is-hidden"></div>
  </header>

  <!-- AZIONI SOTTO LA CABINA -->
  <section class="actions">
    <div class="share-row">
      <button class="share-btn" id="share-audio">
        üéµ Condividi üéµ
      </button>
      <button class="share-btn share-btn-off">
        ‚úçÔ∏è Condividi ‚úçÔ∏è
      </button>
    </div>

    <button id="new">PESCA LA TUA CARTA</button>
  </section>

  <!-- SOTTO CABINA: SOCIAL + TESTO -->
  <main class="wrap">
    <div class="social-buttons">
      <a href="https://www.youtube.com/watch?v=YdEggax27GA&list=PL5l5Dspe3Obumt-dqGDVzM4bHp5Qc_vVx" target="_blank" class="social-btn youtube">YouTube</a>
      <a href="https://www.facebook.com/profile.php?id=61583198656003" target="_blank" class="social-btn facebook">Facebook</a>
      <a href="https://www.instagram.com/chiedilo_all_oracolo_del_rock" target="_blank" class="social-btn instagram">Instagram</a>
    </div>

    <p class="note">L'oracolo custodisce 666 risposte e solo una √® destinata a te. Da un‚Äôidea originale di FredBee ‚Äî tutti i diritti riservati ¬©2025</p>
  </main>

  <!-- CARTE (solo dati) -->
  <script src="cards.js"></script>

  <script>
    const API_KEY     = "AIzaSyDNsQKEvKwHOyZCJ0mojJS325Sbw6wX9as";
    const PLAYLIST_ID = "PL5l5Dspe3Obumt-dqGDVzM4bHp5Qc_vVx";
    const PAGE_SIZE   = 50;

    let player = null;
    let allIds = [];
    let currentVideoId = null;
    let entranceTimer = null;
    let outroInterval = null;
    let outroTriggered = false;
    let textTimer = null;
    let pendingText = null; // üîß per evitare il flash della scritta

    // MOSTRA / NASCONDE IL TESTO NELLA CABINA (NO FLASH)
    function mostraTestoNellaCabina(testo, delayMs = 0){
      const box = document.getElementById("oracle-text");
      if(!box) return;

      if (textTimer){
        clearTimeout(textTimer);
        textTimer = null;
      }

      // Se non c'√® testo: svuoto subito e stop
      if(!testo){
        pendingText = null;
        box.classList.remove("visible");
        box.textContent = "";
        return;
      }

      // Imposto "testo in attesa": finch√© non scatta il delay, la cabina resta VUOTA
      pendingText = testo;
      box.classList.remove("visible");
      box.textContent = "";

      const show = () => {
        // Se nel frattempo √® arrivata un'altra carta, non mostrare questo testo
        if(pendingText !== testo) return;
        box.textContent = testo;
        box.classList.add("visible");
      };

      if (delayMs <= 0){
        requestAnimationFrame(show);
      } else {
        textTimer = setTimeout(() => {
          show();
          textTimer = null;
        }, delayMs);
      }
    }

    // carico API YouTube
    (function(){
      const s = document.createElement('script');
      s.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(s);
    })();

    window.onYouTubeIframeAPIReady = () => {
      player = new YT.Player('yt', {
        height: '390',
        width:  '640',
        playerVars: { modestbranding: 1, rel: 0 },
        events: {
          onReady: onReady,
          onStateChange: onStateChange
        }
      });
    };

    function onReady(){
      let btn     = document.getElementById("new");
      const heroImg = document.querySelector(".hero-img");

      // pulizia di eventuali vecchi listener
